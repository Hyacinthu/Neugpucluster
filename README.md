# Neugpucluster

## 项目背景
深度学习作为工具已经成为研究各类问题的关键技术
* 计算问题
    * 单一设备计算量不足以支持运算需求
    * 不能同时使用多个设备的时候，设备总资源利用率低
* 集成化问题
    * 有很多主流的深度学习框架，如tensorflow,pytorch等
    * 学习成本高
    * 多样的配置方法导致配置频率高
* 统一管理试验过程的问题
    * 需要构建交互系统，统一管理深度学习的试验过程
    * 需要深度学习的试验过程自动化，减少人工的操作
    * 需要对深度学习试验过程中的每一个步骤进行设置

## 项目架构
项目分为三层架构：
* 第一层：分布式集群管理平台
    * 利用zookeeper和mongodb构建集群管理平台，实现集群状态的实时监控和集群的资源管理
* 第二层：分布式深度学习框架
    * 通过容器技术集成多个深度学习框架并调度到集群上，并对中间过程进行优化
* 第三层：实验管理系统（交互界面）
    * 实现试验过程的可视化交互，支持一站式全自动深度学习，支持图形界面下自定义网络结构，自定义数据集

## 设计方案

###  第一层

面临问题
* 集群节点的状态不稳定，随时可能断电，关机，断网等；节点之间难以保证一致性

总体架构
> zookeeper+mongodb

提供服务
> 保证集群中始终有且仅有一个docker容器在运行，监控集群实时状态，提供分布式信息存储。

具体设计
> zookeeper负责监控并记录集群的实时信息，如集群的节点是否断网，断电，是否被占用等，同时提供分布式锁的服务，协调应用程序的需求。mongodb负责提供一些非实时的，数据量较大的存储服务，主要存储运行在集群中的应用的运行信息。　

设计优势
> 相对于kubernetes，这种解决方案更加轻量，逻辑更加简单，易开发和部署。

期望目标
> 高性能地保证集群中始终有且有一个docker容器在运行，提供高效的，分布式环境下正确性有保障的集群api供上层调用。

当前目标 
> 初步搭建基于此设计思想的代码框架，初步实现保证容器运行的功能，初步实现相关api

当前进度
> 相对于当前目标（95％），相对于最终目标（70％）

下一阶段优化
> 进一步划分zookeeper和mongodb的功能，当前部分功能划分未达到要求，这也使得部分api存在较大隐患或对上层未做到完全透明。

### 第二层
面临问题
* 计算资源的定义
* 计算量的定义
* 资源调度的问题
* 计算任务的动态扩展
* 计算中节点的容错策略
* 多框架的问题
* 数据流的问题
* 运算程序的容器化

提供服务
> 保证给定一个计算图，一个数据集，和一个选定的框架可以按照最优的策略将计算图和数据集合进行划分调度到节点上进行执行，并保证它的容错。

具体设计
> 当前第二层设计没有考虑多框架，只使用了tensorflow,它包含一个监控集群中运行任务状态的任务监控器，和一个接受网络结构和数据集作为参数的API接口，API接口针对当前集群状态和给定的网络结构进行节点分配，然后分发到指定机器运行,它完成所有的调度问题;任务运行过程中会受到任务监控器的监控，它会根据当前任务的状态来决定是否重新分配节点等，即它主要负责处理容错问题，

当前进度
> 第二层是项目的关键，目前代码框架基本成型，由于具体的调度策略未确定，以及第一层目前的一些缺陷导致不能支持多用户并行，当前可以实现对于一个任务占用集群全部资源进行tensorflow数据并行方式的分布式训练，且运算程序全部容器化，由于可研究的东西很多，进度不明

下一阶段优化
> 目前由于第一层的某些功能划分的问题，有些API不够可靠，所以第二层当前实现不了太多的调度逻辑，下一阶段主要是确定较为完善的调度策略，和容错策略，以及确定数据的流动规则

### 第三层
面临问题
* 自定义计算图(涉及网络结构的可视化和在线编辑)
* 自定义数据集
* 用户信息的管理
* 训练信息的可视化
* 训练好模型的下载
* 模型库的建立和使用规则
* 程序的容器化

提供服务
> 用户可以自由选择框架，选择数据集（系统自带或自己制作）,选择网络模型（系统自
带或自己制作），一键进行网络训练，可以下载或者在线使用训练好的模型

具体设计
> 使用Django作为服务器，利用web进行交互

当前进度
> 代码框架基本成型，程序的容器化基本完成，可以初步实现自定义数据集，自定义网络结构，一键训练，初步展示训练过程等，相对于当前阶段的进度（94％）,相对于最终目标（54％）。

下一阶段优化
> 增加用户登陆功能，进一步完善计算图编辑模块，实现复杂网络结构的在线编辑，模型的下载和在线使用，优化数据上传过程等
